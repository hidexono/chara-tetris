<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>è„³ãƒˆãƒ¬ ç†Ÿèªãƒ†ãƒˆãƒªã‚¹ï¼ˆé«˜é½¢è€…å‘ã‘ï¼‰</title>
<style>
body {
    background:#f5f9ff;
    font-family: "Yu Gothic","Hiragino Kaku Gothic ProN",sans-serif;
    text-align:center;
}
h1 { font-size:28px; }
#game {
    margin:auto;
    width:300px;
    height:480px;
    border:3px solid #333;
    background:white;
    display:grid;
    grid-template-columns: repeat(6, 1fr);
    grid-template-rows: repeat(10, 1fr);
}
.cell {
    border:1px solid #ddd;
    font-size:28px;
    font-weight:bold;
    display:flex;
    align-items:center;
    justify-content:center;
}
.active {
    background:#4a76ff;
    color:white;
}
.fixed {
    background:#ffb347;
    color:black;
}
#info {
    margin-top:10px;
    font-size:18px;
}
</style>
</head>

<body>

<h1>ğŸ§  ç†Ÿèªãƒ†ãƒˆãƒªã‚¹ï¼ˆè„³ãƒˆãƒ¬ï¼‰</h1>
<div id="game"></div>
<div id="info">ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>

<script>
const cols = 6;
const rows = 10;
const board = [];
const game = document.getElementById("game");
const scoreSpan = document.getElementById("score");

const kanjiList = "è¨˜æ†¶åˆ¤æ–­æ³¨æ„é›†ä¸­åå¿œé€Ÿåº¦å®‰å¿ƒåŠªåŠ›æˆåŠŸæœªæ¥å¸Œæœ›".split("");
const jukugo = ["è¨˜æ†¶","åˆ¤æ–­","æ³¨æ„","é›†ä¸­","åå¿œ","é€Ÿåº¦","å®‰å¿ƒ","åŠªåŠ›","æˆåŠŸ","æœªæ¥","å¸Œæœ›"];

let score = 0;
let current = null;

for(let r=0;r<rows;r++){
    board[r] = [];
    for(let c=0;c<cols;c++){
        board[r][c] = "";
        let div = document.createElement("div");
        div.className = "cell";
        game.appendChild(div);
    }
}

function draw(){
    const cells = document.querySelectorAll(".cell");
    cells.forEach((cell,i)=>{
        let r = Math.floor(i/cols);
        let c = i % cols;
        cell.className = "cell";
        cell.textContent = board[r][c];
        if(current && current.r==r && current.c==c){
            cell.classList.add("active");
            cell.textContent = current.char;
        }
        if(board[r][c]) cell.classList.add("fixed");
    });
}

function newBlock(){
    current = {
        r:0,
        c:Math.floor(cols/2),
        char: kanjiList[Math.floor(Math.random()*kanjiList.length)]
    };
}

function moveDown(){
    if(!current) return;
    if(canMove(current.r+1,current.c)){
        current.r++;
    } else {
        board[current.r][current.c] = current.char;
        current = null;
        checkJukugo();
        newBlock();
    }
    draw();
}

function canMove(r,c){
    if(r>=rows) return false;
    if(board[r][c]) return false;
    return true;
}

function move(dx){
    if(!current) return;
    let nc = current.c + dx;
    if(nc>=0 && nc<cols && canMove(current.r,nc)){
        current.c = nc;
        draw();
    }
}

function checkJukugo(){
    for(let r=0;r<rows;r++){
        for(let c=0;c<cols-1;c++){
            let word = board[r][c] + board[r][c+1];
            if(jukugo.includes(word)){
                board[r][c] = "";
                board[r][c+1] = "";
                score+=10;
                scoreSpan.textContent = score;
                drop();
            }
        }
    }
}

function drop(){
    for(let c=0;c<cols;c++){
        let stack = [];
        for(let r=rows-1;r>=0;r--){
            if(board[r][c]) stack.push(board[r][c]);
        }
        for(let r=rows-1;r>=0;r--){
            board[r][c] = stack.shift() || "";
        }
    }
}

document.addEventListener("keydown", e=>{
    if(e.key=="ArrowLeft") move(-1);
    if(e.key=="ArrowRight") move(1);
    if(e.key=="ArrowDown") moveDown();
});

newBlock();
draw();
setInterval(moveDown, 900);
</script>

</body>
</html>
